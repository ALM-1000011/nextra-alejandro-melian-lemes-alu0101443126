---
title: Informe Pr√°ctica 08 NextAuth  
description: Implementaci√≥n de autenticaci√≥n de usuarios en Nextra con NextAuth  
date: 2024-12-20  
tags:  
  - Nextra  
  - NextAuth  
  - Vercel  
  - GitHub  
---

# üõ°Ô∏è Implementaci√≥n de NextAuth en Nextra  

En esta pr√°ctica hemos incorporado un sistema de autenticaci√≥n para nuestra p√°gina de **Nextra** utilizando **NextAuth** y el proveedor **GitHub**. A continuaci√≥n, exploraremos cada paso del proceso.

---

## üöÄ Instalaci√≥n de NextAuth  

Para comenzar, a√±adimos el paquete de NextAuth a nuestro proyecto ejecutando el siguiente comando en la terminal:  

```bash
npm install next-auth
```

---

## üåê Creaci√≥n de la ruta API  

Creamos una ruta API para manejar las solicitudes de autenticaci√≥n. A√±adimos el archivo `pages/api/auth/[...nextauth].js` con el siguiente contenido:  

```javascript filename="[...nextauth].js" copy showLineNumbers
import NextAuth from "next-auth";
import GithubProvider from "next-auth/providers/github";

export const authOptions = {
  providers: [
    GithubProvider({
      clientId: process.env.GITHUB_ID,
      clientSecret: process.env.GITHUB_SECRET,
    }),
  ],
  secret: process.env.NEXTAUTH_SECRET,
};

export default NextAuth(authOptions);
```

### ‚ùì ¬øPor qu√© `[...nextauth].js`?  
El nombre del archivo permite que **NextAuth** maneje todas las solicitudes relacionadas con autenticaci√≥n desde una √∫nica ruta din√°mica.  

---

## üõ†Ô∏è Configuraci√≥n en GitHub  

Para habilitar la autenticaci√≥n mediante GitHub, generamos un **ID de cliente** y un **secreto de cliente** en [GitHub Developer Settings](https://github.com/settings/apps):  

1. Accedemos al panel de desarrolladores de GitHub.  
2. Creamos una nueva aplicaci√≥n OAuth seleccionando **"New OAuth App"**.  
   ![Crear nueva aplicaci√≥n OAuth](../images/oAuthGithub.png)  
3. Completamos los campos requeridos (URL de autorizaci√≥n y callback).  
   ![Rellenar campos de la aplicaci√≥n OAuth](../images/direccionesCallback.png)  
4. Guardamos el **Client ID** y el **Client Secret** generados.  
   ![Copiar ID y secreto de cliente](../images/tokens.png)  

---

## üîí Configuraci√≥n de variables de entorno  

Para proteger nuestras credenciales, a√±adimos las siguientes variables de entorno en **Vercel**:  

- **GITHUB_ID**  
- **GITHUB_SECRET**  
- **NEXTAUTH_SECRET**  

Pasos:  
1. Accedemos a Vercel y seleccionamos nuestro proyecto.  
2. Vamos a **Settings ‚Üí Environment Variables**.  
3. A√±adimos las variables con sus valores correspondientes.  
4. Guardamos los cambios y desplegamos el proyecto.  

![Variables de Entorno en Vercel](../images/variablesvercel.png)

---

## üß© Modificaci√≥n del `_app.jsx`  

A√±adimos el componente **`SessionProvider`** al archivo `_app.jsx` para gestionar las sesiones. Este es el c√≥digo actualizado:  

```javascript filename="_app.jsx" copy showLineNumbers
import { SessionProvider } from "next-auth/react";

export default function App({ Component, pageProps: { session, ...pageProps } }) {
  return (
    <SessionProvider session={session}>
      <Component {...pageProps} />
    </SessionProvider>
  );
}
```

---

## üë§ Creaci√≥n del bot√≥n de inicio de sesi√≥n  

Creamos un componente **`login-btn.jsx`** para gestionar el inicio y cierre de sesi√≥n:  

```javascript filename="login-btn.jsx" copy showLineNumbers
import { useSession, signIn, signOut } from "next-auth/react";

export default function LoginBtn() {
  const { data: session, status } = useSession();

  if (status === "loading") return <p>Loading...</p>;

  if (session) {
    return (
      <>
        <p>Signed in as {session.user.email}</p>
        <button onClick={() => signOut()}>Sign out</button>
      </>
    );
  }

  return (
    <>
      <p>Not signed in</p>
      <button onClick={() => signIn()}>Sign in</button>
    </>
  );
}
```

### üí° C√≥mo usar este componente  
Basta con importarlo en una p√°gina MDX y a√±adirlo:  

```mdx
import LoginBtn from '@/components/login-btn'

<LoginBtn />
```

---

## üîê Protecci√≥n de rutas  

Creamos un componente **`Restricted.jsx`** para mostrar contenido restringido √∫nicamente a usuarios autenticados:  

```javascript filename="Restricted.jsx" copy showLineNumbers
"use client";

import { useSession } from "next-auth/react";
import styles from "../styles/Counters.module.css";

export default function Restricted() {
  const { data: session, status } = useSession();

  if (status === "authenticated") {
    return (
      <div className={styles.container}>
        <h2>Welcome to the restricted area</h2>
        <ul>
          <li>
            <img src={session.user.image} alt={session.user.name} width="50" />
          </li>
          <li>Email: {session.user.email}</li>
          <li>Name: {session.user.name}</li>
        </ul>
      </div>
    );
  }

  return <a href="/api/auth/signin">Sign in to access this content</a>;
}
```

A√±adimos este componente a una p√°gina MDX para que sea accesible:  

```mdx
import Restricted from '@/components/Restricted'

<Restricted />

## Public Content  
Este contenido es visible para todos los usuarios.
```

---

## üìä Resultados  

- Los usuarios no autenticados ver√°n un bot√≥n para iniciar sesi√≥n.  
- Los usuarios autenticados tendr√°n acceso a contenido restringido y podr√°n cerrar sesi√≥n.  

| Estado       | Vista                           |
|--------------|---------------------------------|
| **Sin sesi√≥n** | ![Sin iniciar sesi√≥n](../images/Noiniciadorestricted.png) |
| **Con sesi√≥n** | ![Sesi√≥n iniciada](../images/Restrictediniciado.png) |

---

## B√°sicamente  

Hemos implementado un sistema de autenticaci√≥n robusto utilizando **NextAuth** y el proveedor **GitHub**, logrando:  

1. Protecci√≥n de rutas y contenido.  
2. Gesti√≥n segura de credenciales mediante variables de entorno.  
3. Integraci√≥n fluida con **Nextra** y **Vercel**.  

Con esta implementaci√≥n, mejoramos la seguridad de nuestra aplicaci√≥n y la experiencia del usuario (te√≥ricamente).
